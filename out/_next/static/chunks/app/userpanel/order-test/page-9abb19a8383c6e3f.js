(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9868],{2785:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});var s=t(5155),l=t(2115),i=t(9911),n=t(883);function r(e){let{title:a}=e,[t,r]=(0,l.useState)(""),[c,o]=(0,l.useState)(""),[d,m]=(0,l.useState)(""),[h,x]=(0,l.useState)("");return(0,l.useEffect)(()=>{let e=localStorage.getItem("package_name");e&&r(e)},[]),(0,l.useEffect)(()=>{(async()=>{let e=localStorage.getItem("package_id"),a=localStorage.getItem("id");if(e)try{let t=await fetch(n.$Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({package_id:e,user_id:a})});if(!t.ok)throw Error("Failed to fetch package details");let s=await t.json();o(s.labtestvalue),m(s.appointment),x(s.pharmacy)}catch(e){console.error("Error fetching package details:",e),r("")}})()},[]),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2",children:[(0,s.jsx)("h4",{className:"fw-bold m-0",children:a}),t&&"undefined"!==t?(0,s.jsxs)("span",{className:"badge bg-primary text-white px-3 py-2",children:["Currently Active Package: ",t]}):(0,s.jsx)("span",{className:"badge bg-danger text-white px-3 py-2",children:"No Active Package"})]}),(0,s.jsxs)("div",{className:"d-flex flex-column flex-md-row justify-content-center align-items-stretch align-items-md-center gap-3",children:[(0,s.jsxs)("div",{className:"rounded px-3 py-2 text-white bg-primary d-flex align-items-center gap-2 m-2",children:[(0,s.jsx)(i.XcJ,{size:16,className:"mr-1"}),(0,s.jsxs)("span",{className:"fw-semibold",children:["Lab Credit : ₹",null!=c?c:0]})]}),(0,s.jsxs)("div",{className:"rounded px-3 py-2 text-white bg-success d-flex align-items-center gap-2 m-2",children:[(0,s.jsx)(i.gUT,{size:16,className:"mr-1"}),(0,s.jsxs)("span",{className:"fw-semibold",children:["Appointment Credits : ",d]})]}),(0,s.jsxs)("div",{className:"rounded px-3 py-2 text-white bg-danger d-flex align-items-center gap-2 m-2",children:[(0,s.jsx)(i.I1M,{size:16,className:"mr-1"}),(0,s.jsxs)("span",{className:"fw-semibold",children:["Medicines Credits : ",h]})]})]})]})}},5248:(e,a,t)=>{Promise.resolve().then(t.bind(t,9025))},9025:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>x});var s=t(5155),l=t(143),i=t(2115),n=t(883),r=t(9911),c=t(3568),o=t(4752),d=t.n(o);function m(){let[e,a]=(0,i.useState)([]),[t,l]=(0,i.useState)(""),[o,m]=(0,i.useState)(!1),[h,x]=(0,i.useState)(1),[u,g]=(0,i.useState)(!0),[j,b]=(0,i.useState)(!1),[p,f]=(0,i.useState)([]),[N,v]=(0,i.useState)(!1),[y,S]=(0,i.useState)(""),[w,C]=(0,i.useState)(""),[k,O]=(0,i.useState)(""),[T,A]=(0,i.useState)(""),[E,I]=(0,i.useState)(""),[_,F]=(0,i.useState)(""),[P,M]=(0,i.useState)(""),[L,q]=(0,i.useState)(""),[J,D]=(0,i.useState)(""),[R,$]=(0,i.useState)([]),[z,B]=(0,i.useState)(""),[G,U]=(0,i.useState)(""),[Y,H]=(0,i.useState)(""),[Q,K]=(0,i.useState)(""),[X,V]=(0,i.useState)(""),[W,Z]=(0,i.useState)(""),[ee,ea]=(0,i.useState)(""),[et,es]=(0,i.useState)({}),el=()=>{let e={};return G.trim()||(e.patientName="Patient name is required"),Y.trim()?/^\d{10}$/.test(Y)||(e.mobile="Enter a valid 10-digit mobile number"):e.mobile="Mobile number is required",Q&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Q)&&(e.email="Invalid email"),X||(e.age="Age is required"),ee||(e.relation="Relation is required"),W||(e.gender="Gender is required"),y.trim()||(e.address="Address is required"),w?/^\d{6}$/.test(w)||(e.pincode="Enter a valid 6-digit pincode"):e.pincode="Pincode is required",es(e),0===Object.keys(e).length};(0,i.useEffect)(()=>{(async()=>{if(6===w.length)try{let e=await fetch("https://api.postalpincode.in/pincode/".concat(w)),a=await e.json();if("Success"===a[0].Status){let e=a[0].PostOffice[0];O(e.State),A(e.District)}else O(""),A(""),c.Ay.error("Invalid Pincode")}catch(e){console.error("Error fetching state/city from pincode",e),c.Ay.error("Failed to fetch location info")}})()},[w]),(0,i.useEffect)(()=>{let e=async()=>{let e=localStorage.getItem("id");if(e)try{let a=await fetch(n.eq,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e})}),t=await a.json();a.ok?(console.log(t.data),$(t.data)):$([])}catch(e){console.error("Failed to fetch family members:",e),$([])}};N&&e()},[N]),(0,i.useEffect)(()=>{(async()=>{let e=localStorage.getItem("package_id"),a=localStorage.getItem("id");if(e)try{let t=await fetch(n.$Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({package_id:e,user_id:a})});t.ok||c.Ay.error("Error in fetching package details!");let s=await t.json();M(s.labtestvalue),q(s.appointment),D(s.pharmacy)}catch(e){c.Ay.error("Error in fetching package details!")}})()},[]),(0,i.useEffect)(()=>{let e=localStorage.getItem("selectedLabTests");e&&f(JSON.parse(e))},[]);let ei=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";m(!0);try{let s=await fetch("".concat(n.E_,"?page=").concat(e,"&search=").concat(encodeURIComponent(t))),l=await s.json();a(l),g(l.length>0)}catch(e){console.error("Failed to load tests:",e),g(!1)}finally{m(!1)}};(0,i.useEffect)(()=>{let e=setTimeout(()=>{x(1),ei(1,t)},300);return()=>clearTimeout(e)},[t]);let en=e=>{e<1||(x(e),ei(e,t))},er=e=>{if(p.find(a=>a.id===e.id))return void c.Ay.error("This test is already added.");let a=p.reduce((e,a)=>e+parseFloat(a.total),0),t=0===p.length?parseFloat(e.collection_charges):0,s=parseFloat(e.total),l=parseFloat(P||"0");if(a+s+t>l)return void c.Ay.error("Insufficient lab credits. Max: ₹".concat(l));let i=[...p,e];f(i),localStorage.setItem("selectedLabTests",JSON.stringify(i)),c.Ay.success("Test Added.")},ec=e=>{let a=p.filter(a=>a.id!==e);f(a),localStorage.setItem("selectedLabTests",JSON.stringify(a)),c.Ay.error("Test removed.")},eo=p.reduce((e,a)=>e+parseFloat(a.total),0),ed=p.length>0?parseFloat(p[0].collection_charges):0,em=eo+ed,eh=parseFloat(P||"0"),ex=async e=>{if(e.preventDefault(),!el())return;let a=localStorage.getItem("id");if(b(!0),!a)return void c.Ay.error("User not logged In");if(em>eh)return void c.Ay.error("Total amount exceeds available lab credits.");let t={patient_name:G,user_id:a,mobile:Y,email:Q,age:X,gender:W,relation:ee,address:y,state:k,city:T,pincode:w,date:E,time:_,test_ids:p.map(e=>e.id),total_amount:em};try{let e=await fetch(n.Yv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await e.json();e.ok?(d().fire({title:"Success!",text:"Order Placed Successfully.\nYour Order Code is: ".concat(a.order_code),icon:"success",confirmButtonText:"OK"}).then(()=>{window.location.href="/userpanel/test-orders"}),v(!1),U(""),H(""),K(""),V(""),Z("Male"),f([]),localStorage.removeItem("selectedLabTests")):c.Ay.error("Failed to submit: "+a.message),b(!1)}catch(e){console.error(e),c.Ay.error("Error submitting patient form."),b(!1)}};return(0,s.jsxs)("div",{className:"row justify-content-center",children:[(0,s.jsxs)("div",{className:"col-md-12",children:[(0,s.jsxs)("div",{className:"alert alert-info d-flex justify-content-between align-items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Tests Total:"})," ₹",eo," ",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Collection Charges:"})," ₹",ed," ",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Total Amount:"})," ",(0,s.jsxs)("span",{className:em>eh?"text-danger fw-bold":"",children:["₹",em]})]}),em>0&&em<=eh?(0,s.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>v(!0),children:"Proceed"}):em>eh?(0,s.jsx)("span",{className:"text-danger",children:"Exceeds available credits"}):null]}),(0,s.jsx)("input",{type:"text",placeholder:"Search lab tests...",className:"form-control mb-3",value:t,onChange:e=>l(e.target.value)}),(0,s.jsxs)("div",{className:"bg-white rounded p-0",style:{minHeight:"300px"},children:[0===e.length&&!o&&(0,s.jsx)("p",{className:"text-center text-muted",children:"No tests found"}),e.map(e=>{let a=p.some(a=>a.id===e.id);return(0,s.jsx)("div",{className:"border rounded mb-3 p-3 position-relative shadow-sm",children:(0,s.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h6",{className:"mb-2",children:e.test_name}),(0,s.jsxs)("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[(0,s.jsx)("span",{className:"text-muted",children:(0,s.jsxs)("del",{children:["₹",e.price]})}),(0,s.jsxs)("span",{className:"badge text-black",children:["₹",e.total]}),(0,s.jsxs)("span",{className:"badge bg-danger text-white",children:[e.discount,"% OFF"]})]}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)("span",{className:"badge bg-secondary text-white",children:["Collection Charges: ₹",e.collection_charges," Per Order"]})})]}),a?(0,s.jsxs)("button",{className:"btn btn-sm btn-danger",onClick:()=>ec(e.id),children:[(0,s.jsx)(r.iu5,{})," Remove"]}):(0,s.jsxs)("button",{className:"btn btn-sm btn-primary",onClick:()=>er(e),children:[(0,s.jsx)(r.OiG,{})," Add"]})]})},e.id)}),o&&(0,s.jsx)("p",{className:"text-center mt-3",children:"Loading..."})]}),(0,s.jsx)("nav",{className:"mt-3",children:(0,s.jsxs)("ul",{className:"pagination justify-content-center mb-0",children:[(0,s.jsx)("li",{className:"page-item ".concat(1===h?"disabled":""),children:(0,s.jsx)("button",{className:"page-link",onClick:()=>en(h-1),children:"Previous"})}),(0,s.jsx)("li",{className:"page-item disabled",children:(0,s.jsxs)("span",{className:"page-link",children:["Page ",h]})}),(0,s.jsx)("li",{className:"page-item ".concat(u?"":"disabled"),children:(0,s.jsx)("button",{className:"page-link",onClick:()=>en(h+1),children:"Next"})})]})})]}),N&&(0,s.jsx)("div",{className:"modal d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,s.jsx)("div",{className:"modal-dialog modal-lg",children:(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h5",{className:"modal-title",children:"Enter Patient Details"}),(0,s.jsx)("button",{type:"button",className:"btn-close",onClick:()=>v(!1)})]}),(0,s.jsxs)("div",{className:"modal-body",style:{maxHeight:"80vh",overflowY:"auto"},children:[R.length>0&&(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{className:"form-label",children:"Select Family Member"}),(0,s.jsxs)("select",{className:"form-control",value:z,onChange:e=>{let a=e.target.value;B(a);let t=localStorage.getItem("mobile"),s=localStorage.getItem("email"),l=localStorage.getItem("address");for(let e=0;e<localStorage.length;e++){let a=localStorage.key(e),t=localStorage.getItem(a||"");console.log("".concat(a,": ").concat(t))}S(l||""),K(s||""),H(t||"");let i=R.find(e=>String(e.id)===a);console.log("Selected member:",i),i?(U(i.name||""),V(i.age||""),Z(i.gender||""),ea(i.relation||"")):(U(""),V(""),H(""),K(""),Z(""),ea(""))},children:[(0,s.jsx)("option",{value:"",children:"-- Select Member --"}),R.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.relation||"Self",")"]},e.id))]})]}),(0,s.jsx)("form",{onSubmit:ex,children:(0,s.jsxs)("div",{className:"row",children:[(0,s.jsxs)("div",{className:"mb-3 col-md-12",children:[(0,s.jsx)("label",{className:"form-label",children:"Patient Name"}),(0,s.jsx)("input",{type:"text",className:"form-control",value:G,onChange:e=>U(e.target.value)}),et.patientName&&(0,s.jsx)("div",{className:"text-danger",children:et.patientName})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-6",children:[(0,s.jsx)("label",{className:"form-label",children:"Mobile Number"}),(0,s.jsx)("input",{type:"tel",className:"form-control",value:Y,onChange:e=>H(e.target.value)}),et.mobile&&(0,s.jsx)("div",{className:"text-danger",children:et.mobile})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-6",children:[(0,s.jsx)("label",{className:"form-label",children:"Email"}),(0,s.jsx)("input",{type:"email",className:"form-control",value:Q,onChange:e=>K(e.target.value)}),et.email&&(0,s.jsx)("div",{className:"text-danger",children:et.email})]}),(0,s.jsxs)("div",{className:"mb-3  col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"Age"}),(0,s.jsx)("input",{type:"number",className:"form-control",value:X,onChange:e=>V(e.target.value)}),et.age&&(0,s.jsx)("div",{className:"text-danger",children:et.age})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"Relation"}),(0,s.jsxs)("select",{className:"form-control",value:ee,onChange:e=>ea(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select Relation"}),(0,s.jsx)("option",{value:"Father",children:"Father"}),(0,s.jsx)("option",{value:"Mother",children:"Mother"}),(0,s.jsx)("option",{value:"Son",children:"Son"}),(0,s.jsx)("option",{value:"Daughter",children:"Daughter"}),(0,s.jsx)("option",{value:"Spouse",children:"Spouse"}),(0,s.jsx)("option",{value:"Sibling",children:"Sibling"}),(0,s.jsx)("option",{value:"Self",children:"Self"}),(0,s.jsx)("option",{value:"Other",children:"Other"})]}),et.relation&&(0,s.jsx)("div",{className:"text-danger",children:et.relation})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"Gender"}),(0,s.jsxs)("select",{className:"form-control",value:W,onChange:e=>Z(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select"}),(0,s.jsx)("option",{value:"Male",children:"Male"}),(0,s.jsx)("option",{value:"Female",children:"Female"}),(0,s.jsx)("option",{value:"Other",children:"Other"})]}),et.gender&&(0,s.jsx)("div",{className:"text-danger",children:et.gender})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-12",children:[(0,s.jsx)("label",{className:"form-label",children:"Address"}),(0,s.jsx)("textarea",{className:"form-control",rows:2,value:y,onChange:e=>S(e.target.value)}),et.address&&(0,s.jsx)("div",{className:"text-danger",children:et.address})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"Pincode"}),(0,s.jsx)("input",{type:"text",className:"form-control",value:w,onChange:e=>C(e.target.value),maxLength:6}),et.pincode&&(0,s.jsx)("div",{className:"text-danger",children:et.pincode})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"State"}),(0,s.jsx)("input",{type:"text",className:"form-control",value:k,readOnly:!0}),et.state&&(0,s.jsx)("div",{className:"text-danger",children:et.state})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"City"}),(0,s.jsx)("input",{type:"text",className:"form-control",value:T,readOnly:!0}),et.city&&(0,s.jsx)("div",{className:"text-danger",children:et.city})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"Collection Date"}),(0,s.jsx)("input",{type:"date",className:"form-control",value:E,onChange:e=>I(e.target.value)}),et.city&&(0,s.jsx)("div",{className:"text-danger",children:et.date})]}),(0,s.jsxs)("div",{className:"mb-3 col-md-4",children:[(0,s.jsx)("label",{className:"form-label",children:"Collection Time"}),(0,s.jsx)("input",{type:"time",className:"form-control",value:_,onChange:e=>F(e.target.value)}),et.city&&(0,s.jsx)("div",{className:"text-danger",children:et.time})]}),(0,s.jsxs)("div",{className:"mb-3  col-md-12 d-flex",children:[(0,s.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:j,children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Processing..."]}):"Book Now"}),(0,s.jsx)("button",{type:"button",className:"btn btn-danger ml-2",onClick:()=>v(!1),children:"Close"})]})]})})]})]})})})]})}var h=t(2785);function x(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.default,{}),(0,s.jsx)("div",{className:"min-vh-100 d-flex justify-content-center align-items-start bg-light py-4",children:(0,s.jsx)("div",{className:"container",children:(0,s.jsx)("div",{className:"row justify-content-center",children:(0,s.jsxs)("div",{className:"col-lg-12 col-md-12",children:[(0,s.jsx)(h.A,{title:"Book Lab Test"}),(0,s.jsxs)("div",{className:"card shadow-sm border-0",children:[(0,s.jsx)("div",{className:"card-header bg-primary text-white",children:(0,s.jsx)("h4",{className:"mb-0 text-white",children:"List of Available Lab Test"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(m,{})})]})]})})})})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[9675,6711,8320,5180,3568,143,8441,1684,7358],()=>a(5248)),_N_E=e.O()}]);