(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5466],{3628:(e,a,s)=>{Promise.resolve().then(s.bind(s,7303))},7303:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>g});var t=s(5155),l=s(2115),n=s(7124),r=s(4040),i=s(883),c=s(5028),o=s(4752),d=s.n(o),m=s(143),h=s(9911),u=s(7820),x=s(3568);let p=["Father","Mother","Spouse","Son","Daughter","Other"];function b(e){let{referredby:a,onClose:s,onSuccess:n}=e,[r,c]=(0,l.useState)({name:"",email:"",phone:"",fatherName:"",address:"",state:"",city:"",country:"",pan:"",aadhar:"",dob:"",age:"",pincode:""}),[o,d]=(0,l.useState)([{relation:"",name:"",age:""}]),[m,h]=(0,l.useState)({}),[u,b]=(0,l.useState)([]),[g,f]=(0,l.useState)("");(0,l.useEffect)(()=>{fetch(i.ox).then(e=>e.json()).then(e=>b(e.data)).catch(e=>console.error("Failed to fetch packages:",e))},[]),(0,l.useEffect)(()=>{if(r.dob){let e=new Date(r.dob),a=new Date,s=a.getFullYear()-e.getFullYear(),t=a.getMonth()-e.getMonth();(t<0||0===t&&a.getDate()<e.getDate())&&s--,c(e=>({...e,age:s.toString()}))}},[r.dob]);let j=async e=>{let{name:a,value:s}=e.target;if(c(e=>({...e,[a]:s})),"pincode"===a&&/^\d{6}$/.test(s))try{var t;let e=await fetch("https://api.postalpincode.in/pincode/".concat(s)),a=await e.json();if("Success"===a[0].Status&&(null==(t=a[0].PostOffice)?void 0:t.length)){let e=a[0].PostOffice[0];c(a=>({...a,state:e.State,city:e.District,country:e.Country})),h(e=>({...e,pincode:""}))}else h(e=>({...e,pincode:"Invalid pincode"})),c(e=>({...e,state:"",city:"",country:""}))}catch(e){h(e=>({...e,pincode:"Error fetching location"})),c(e=>({...e,state:"",city:"",country:""}))}},N=(e,a)=>{let s=[...o];s[e][a.target.name]=a.target.value,d(s)},y=e=>d(a=>a.filter((a,s)=>s!==e)),v=()=>{let e={};return g||(e.package="Please select a package."),Object.entries(r).forEach(a=>{let[s,t]=a;t||"age"===s||(e[s]="This field is required")}),r.phone&&!/^\d{10}$/.test(r.phone)&&(e.phone="Phone must be 10 digits."),r.aadhar&&!/^\d{12}$/.test(r.aadhar)&&(e.aadhar="Aadhar must be 12 digits."),r.email&&!/^\S+@\S+\.\S+$/.test(r.email)&&(e.email="Invalid email address."),r.pan&&!/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(r.pan.toUpperCase())&&(e.pan="Invalid PAN format."),r.pincode&&!/^\d{6}$/.test(r.pincode)&&(e.pincode="Pincode must be 6 digits."),o.forEach((a,s)=>{a.relation&&a.name&&a.age?(isNaN(Number(a.age))||0>=Number(a.age))&&(e["familyMember-".concat(s)]="Valid family member age required."):e["familyMember-".concat(s)]="All family member fields required."}),h(e),0===Object.keys(e).length},w=async e=>{if(e.preventDefault(),v())try{let e=await fetch(i.ff,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,referredby:a,familyMembers:o,package_id:g})}),s=await e.json();e.ok&&s.status?n():x.Ay.error((null==s?void 0:s.message)||"Error submitting data.")}catch(e){x.Ay.error(e.message||"Error occurred.")}};return(0,t.jsxs)("form",{onSubmit:w,className:"container my-4",children:[(0,t.jsxs)("div",{className:"row g-3",children:[(0,t.jsxs)("div",{className:"col-md-12",children:[(0,t.jsx)("label",{className:"form-label",children:"Select Package"}),(0,t.jsxs)("select",{className:"form-control",value:g,onChange:e=>f(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select Package"}),u.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.package_name," (Rs. ",e.amount,")"]},e.id))]}),m.package&&(0,t.jsx)("div",{className:"text-danger",children:m.package})]}),[{label:"Name",name:"name"},{label:"Email",name:"email"},{label:"Phone",name:"phone"},{label:"Father's Name",name:"fatherName"},{label:"PAN",name:"pan"},{label:"Aadhar Number",name:"aadhar"},{label:"Date of Birth",name:"dob",type:"date"}].map(e=>{let{label:a,name:s,type:l="text"}=e;return(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{className:"form-label",children:a}),(0,t.jsx)("input",{type:l,name:s,value:r[s],onChange:j,className:"form-control"}),m[s]&&(0,t.jsx)("div",{className:"text-danger",children:m[s]})]},s)}),(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{className:"form-label",children:"Age"}),(0,t.jsx)("input",{type:"text",value:r.age,disabled:!0,className:"form-control"})]}),(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{className:"form-label",children:"Pincode"}),(0,t.jsx)("input",{type:"text",name:"pincode",value:r.pincode,onChange:j,className:"form-control"}),m.pincode&&(0,t.jsx)("div",{className:"text-danger",children:m.pincode})]}),["state","city","country"].map(e=>(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{className:"form-label",children:e.charAt(0).toUpperCase()+e.slice(1)}),(0,t.jsx)("input",{name:e,value:r[e],onChange:j,className:"form-control",readOnly:!0}),m[e]&&(0,t.jsx)("div",{className:"text-danger",children:m[e]})]},e)),(0,t.jsxs)("div",{className:"col-12",children:[(0,t.jsx)("label",{className:"form-label",children:"Address"}),(0,t.jsx)("textarea",{name:"address",value:r.address,onChange:j,className:"form-control",rows:3}),m.address&&(0,t.jsx)("div",{className:"text-danger",children:m.address})]})]}),(0,t.jsx)("hr",{className:"my-4"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"mb-3",children:"Family Members"}),o.map((e,a)=>(0,t.jsxs)("div",{className:"row g-2 align-items-end mb-3",children:[(0,t.jsxs)("div",{className:"col-md-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Relation"}),(0,t.jsxs)("select",{name:"relation",value:e.relation,onChange:e=>N(a,e),className:"form-control",children:[(0,t.jsx)("option",{value:"",children:"Select Relation"}),p.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"Name"}),(0,t.jsx)("input",{name:"name",value:e.name,onChange:e=>N(a,e),className:"form-control"})]}),(0,t.jsxs)("div",{className:"col-md-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Age"}),(0,t.jsx)("input",{name:"age",type:"number",value:e.age,onChange:e=>N(a,e),className:"form-control"})]}),(0,t.jsx)("div",{className:"col-md-2",children:(0,t.jsx)("button",{type:"button",onClick:()=>y(a),className:"btn btn-outline-danger btn-sm mt-4",children:"Remove"})}),m["familyMember-".concat(a)]&&(0,t.jsx)("div",{className:"text-danger w-100",children:m["familyMember-".concat(a)]})]},a)),(0,t.jsx)("button",{type:"button",onClick:()=>d(e=>[...e,{relation:"",name:"",age:""}]),className:"btn btn-outline-primary btn-sm",children:"+ Add Family Member"})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})}(0,c.default)(()=>Promise.resolve().then(s.bind(s,9981)),{loadableGenerated:{webpack:()=>[9981]},ssr:!1});let g=()=>{let[e,a]=(0,l.useState)([]),[s,c]=(0,l.useState)([]),[o,p]=(0,l.useState)(!0),[g,f]=(0,l.useState)(null),[j,N]=(0,l.useState)(""),[y,v]=(0,l.useState)(!1),[w,C]=(0,l.useState)(null),[S,k]=(0,l.useState)(!1),[A,P]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=localStorage.getItem("id");e?f(Number(e)):(console.warn("No user_id found in localStorage"),p(!1))},[]),(0,l.useEffect)(()=>{g&&_(g)},[g]);let _=async e=>{p(!0);try{let s=await fetch(i.H,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e})}),t=await s.json(),l=Array.isArray(t.data)?t.data:[t.data];a(l),c(l)}catch(e){console.error("Error loading data:",e)}finally{p(!1)}};(0,l.useEffect)(()=>{c(e.filter(e=>{var a,s,t,l,n,r;let i=j.toLowerCase();return(null==(a=e.name)?void 0:a.toLowerCase().includes(i))||(null==(s=e.email)?void 0:s.toLowerCase().includes(i))||(null==(t=e.policy_id)?void 0:t.toLowerCase().includes(i))||(null==(l=e.customer_id)?void 0:l.toLowerCase().includes(i))||(null==(n=e.package_name)?void 0:n.toLowerCase().includes(i))||(null==(r=e.mobile)?void 0:r.toLowerCase().includes(i))}))},[j,e]);let E=e=>{P(e),k(!0)},O=async e=>{if((await d().fire({title:"Are you sure?",text:"This action will delete the user permanently!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{let a=await fetch(i.w0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:e})}),s=await a.json();s.status?(d().fire("Deleted!",s.message,"success"),g&&_(g)):d().fire("Error!",s.message,"error")}catch(e){d().fire("Error!","Something went wrong.","error")}},T=[{name:"S.No.",cell:(e,a)=>a+1,width:"80px"},{name:"Customer Name",cell:e=>(0,t.jsxs)("div",{className:"d-flex flex-column",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsx)("span",{className:"badge bg-info text-white mt-1",style:{width:"100px"},children:e.customer_id})]}),sortable:!0},{name:"Contact Details",cell:e=>(0,t.jsxs)("div",{className:"d-flex flex-column",children:[(0,t.jsx)("span",{className:"badge bg-primary text-white mt-1",children:e.email}),(0,t.jsx)("span",{className:"badge bg-info text-white mt-1",style:{width:"100px"},children:e.mobile})]}),sortable:!0},{name:"Package Details",cell:e=>(0,t.jsxs)("div",{className:"d-flex flex-column",children:[(0,t.jsx)("span",{className:"badge bg-success text-white me-2 mt-1 mr-2 w-100",children:e.package_name}),(0,t.jsx)("span",{className:"badge bg-warning  mt-1  w-100",style:{width:"100px"},children:e.policy_id}),(0,t.jsxs)("span",{className:"badge  text-white mt-1  w-100 ".concat("Paid"===e.purchase_status?"bg-success":"bg-danger"),children:["Payment Status:  ",e.purchase_status]}),(0,t.jsxs)("span",{className:"badge mt-1 mb-1 text-white w-100 ".concat("Approved"===e.final_approval?"bg-success":"bg-danger"),children:[(0,t.jsx)("i",{className:"fa ".concat("Approved"===e.final_approval?"fa-check-circle":"fa-times-circle"," me-1")})," ","Approved"===e.final_approval?"Verified":"Non Verified"]})]}),sortable:!0},{name:"Address",selector:e=>e.address,sortable:!0,width:"200px",cell:e=>(0,t.jsx)("div",{style:{whiteSpace:"normal",wordBreak:"break-word"},children:e.address})},{name:"State",selector:e=>e.state,sortable:!0,width:"100px"},{name:"City",selector:e=>e.city,sortable:!0,width:"100px"},{name:"Actions",cell:e=>(0,t.jsxs)(t.Fragment,{children:[e.package_name?null:(0,t.jsx)("button",{title:"Assign Package",className:"btn btn-sm btn-primary me-2 mr-1",onClick:()=>E(e),children:(0,t.jsx)(h.rrY,{})}),e.token&&(0,t.jsxs)("button",{title:"Copy Payment Link",className:"btn btn-sm btn-secondary me-2 mr-1",onClick:()=>{let a="https://payment.smart-health.co.in?token=".concat(e.token);navigator.clipboard.writeText(a).then(()=>{x.Ay.success("Payment Link Copied.")}).catch(e=>{x.Ay.error("Copy failed:",e),alert("Copy failed. Please try again.")})},children:[(0,t.jsx)(h.Y4c,{})," "]}),(0,t.jsx)("button",{title:"Delete Customer",className:"btn btn-sm btn-danger ml-5",onClick:()=>O(e.id),children:(0,t.jsx)(h.qbC,{})})]}),ignoreRowClick:!0,allowOverflow:!0,button:!0,width:"100px"}];return!g&&o?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.default,{}),(0,t.jsxs)(r.A,{show:S,onHide:()=>k(!1),centered:!0,className:"custom-modal-width",children:[(0,t.jsx)(r.A.Header,{closeButton:!0,children:A&&(0,t.jsxs)(r.A.Title,{children:["Assign Package To - ",(0,t.jsx)("strong",{children:A.name})]})}),(0,t.jsx)(r.A.Body,{children:A&&(0,t.jsx)(u.default,{agent_id:g||void 0,customer_id:A.id})})]}),(0,t.jsxs)("div",{className:"min-h-screen flex flex-col bg-light",children:[(0,t.jsx)("div",{className:"container-fluid flex-grow h-100",children:(0,t.jsx)("div",{className:"row banner-content",children:(0,t.jsx)("div",{className:"col-lg-12",children:(0,t.jsx)("div",{className:"row",children:(0,t.jsx)("div",{className:"col-md-12",children:(0,t.jsxs)("div",{className:"card p-4 shadow mt-3 mb-3",style:{width:"100%"},children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsx)("h4",{className:"text-xl font-bold m-0",children:"Customers"}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{g&&(C(null),v(!0))},children:"Add Customer"})]}),(0,t.jsx)(n.Ay,{columns:T,data:s,progressPending:o,pagination:!0,responsive:!0,subHeader:!0,subHeaderComponent:(0,t.jsx)("div",{className:"d-flex w-100",children:(0,t.jsx)("input",{type:"text",className:"form-control me-auto",style:{width:"30%"},placeholder:"Search",value:j,onChange:e=>N(e.target.value)})})})]})})})})})}),(0,t.jsxs)(r.A,{show:y,onHide:()=>v(!1),centered:!0,dialogClassName:"responsive-modal",children:[(0,t.jsx)(r.A.Header,{closeButton:!0,children:(0,t.jsx)(r.A.Title,{children:w?"Edit Customer":"Add Customer"})}),(0,t.jsx)(r.A.Body,{children:g&&(0,t.jsx)(b,{referredby:g,onClose:()=>v(!1),onSuccess:()=>{v(!1),_(g)}})})]})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[9675,6711,8320,5180,3568,7124,4040,659,143,7820,8441,1684,7358],()=>a(3628)),_N_E=e.O()}]);